#!/bin/bash

file_count=$#
file1=$1
file2=$2
file3=$3
all_files="$file1 $file2 $file3"
header_output=false

if [ "$file_count" != 3 ]; then
	echo "Enter exactly 3 files, please"
	exit 1
fi

for file in $all_files; do
	header=$(head -n 1 "$file")

	if ! echo "$header" | grep -q $'\t'; then
		echo "$file is not tab separated"
		exit 1
	fi

	cells_header=$(echo "$header" | awk -F '\t' '{print NF}')

	continent_ind=$(echo "$header" | awk -F '\t' '{for(i=1; i<=NF; i++) if($i=="Continent") print i}')

	if [ "$header_output" == false ]; then
		if [ -n "$continent_ind" ]; then
			echo "$header" | awk -v ind="$continent_ind" 'BEGIN{FS=OFS="\t"}{for(i=1; i<=NF; i++) if(i!=ind) {printf "%s", $i; if(i<NF) printf OFS}; print ""}'
		else
			echo "$header"
		fi
		header_output=true
	fi

	line_count=2

	tail -n +2 "$file" | while IFS= read -r line; do
		cells_line=$(echo "$line" | awk -F '\t' '{print NF}')


		if [ "$cells_line" != "$cells_header" ]; then
			echo "The line #$line_count has different number of cells($cells_line) than in the header($cells_header)!"
			((line_count++))
			continue
		fi

		((line_count++))
	done
done
